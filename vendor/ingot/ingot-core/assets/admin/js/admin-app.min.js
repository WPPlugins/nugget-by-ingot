var ingotApp=angular.module("ingotApp",["ui.router","ui.bootstrap","colorpicker.module","ngAria","ngResource","ngclipboard","ngSanitize"]).run(function(a,b){a.translate=INGOT_TRANSLATION,a.partials_url=INGOT_ADMIN.partials,a.$on("$stateChangeSuccess",function(b,c,d,e,f){"clickTests"==c.name?a.main_click_tests_page=!0:a.main_click_tests_page=!1,"priceTests"==c.name?a.main_price_tests_page=!0:a.main_price_tests_page=!1}),a.isActiveNav=function(a){return b.current.name&&b.current.name.indexOf(a)>=0?"active":void 0}});ingotApp.config(function(a,b){if(b.otherwise("/"),a.state("clickTests",{url:"/click-tests",templateUrl:INGOT_ADMIN.partials+"/click-groups.html"}).state("clickTests.list",{url:"/click-tests/all",templateUrl:INGOT_ADMIN.partials+"/list.html",controller:"clickGroups"}).state("clickTests.edit",{url:"/click-tests/edit/:groupID",templateUrl:INGOT_ADMIN.partials+"/click-group.html",controller:"clickGroup"}).state("clickTests.new",{url:"/click-tests/new",templateUrl:INGOT_ADMIN.partials+"/click-group.html",controller:"clickGroup"}).state("clickTests.delete",{url:"/click-tests/delete/:groupID",controller:"clickDelete"}).state("clickTests.stats",{url:"/click-tests/stats/:groupID",templateUrl:INGOT_ADMIN.partials+"/click-group.stats.html",controller:"clickStats"}).state("settings",{url:"/settings",templateUrl:INGOT_ADMIN.partials+"/settings.html",controller:"settings"}).state("support",{url:"/support",templateUrl:INGOT_ADMIN.partials+"/support.html",controller:"support"}).state("otherwise",{url:"/",templateUrl:INGOT_ADMIN.partials+"/welcome.html",controller:"welcome"}),1==INGOT_ADMIN.dev_mode)a.state("priceTests",{url:"/price-tests",templateUrl:INGOT_ADMIN.partials+"/price-groups.html",controller:"priceGroups"}).state("priceTests.list",{url:"/price-tests/all",templateUrl:INGOT_ADMIN.partials+"/list.html",controller:"priceGroups"}).state("priceTests.edit",{url:"/price-tests/edit/:groupID",templateUrl:INGOT_ADMIN.partials+"/price-group.html",controller:"priceGroup"}).state("priceTests.new",{url:"/price-tests/new/",templateUrl:INGOT_ADMIN.partials+"/price-group.html",controller:"priceGroup"});else{var c='<div class="alert alert-info"><h1>'+INGOT_TRANSLATION.price_coming_soon+"</h1></div>";a.state("priceTests",{url:"/price-tests",template:c}).state("priceTests.list",{url:"/price-tests/all",templateUrl:INGOT_ADMIN.partials+"/price-nope.html"}).state("priceTests.edit",{url:"/price-tests/edit/:groupID",templateUrl:INGOT_ADMIN.partials+"/price-nope.html"}).state("priceTests.new",{url:"/price-tests/new/",templateUrl:INGOT_ADMIN.partials+"/price-nope.html"})}}),ingotApp.controller("clickGroups",["$scope","$http","groupsFactory","$sce",function(a,b,c,d){var e=10;a.description=d.trustAsHtml(INGOT_TRANSLATION.descriptions.click),c.query({page:1,limit:e,context:"admin",type:"click"},function(b){if(b.data.indexOf("No matching")>-1)return void(a.groups={});a.groups=JSON.parse(b.data);var c=parseInt(b.headers["x-ingot-total"]),d=c/e;a.total_pages=new Array(Math.round(d)),a.groups.shortcode=[]}),a.paginate=function(b,d){jQuery(".paginate a.active").length&&jQuery(".paginate a.active").toggleClass("active"),jQuery(d.currentTarget).toggleClass("active"),b+=1,c.query({page:b,limit:e,context:"admin"},function(b){b.data.indexOf("No matching groups found.")>=0||(a.groups=JSON.parse(b.data))})},a.enter=function(a){setTimeout(function(){jQuery("#shortcode-pre-"+a).hide().attr("aria-hidden","true").css("visibility","hidden"),jQuery("#shortcode-copy-"+a).show().attr("aria-hidden","false").css("visibility","visible")},350)},a.exit=function(a){setTimeout(function(){jQuery("#shortcode-copy-"+a).hide().attr("aria-hidden","true").css("visibility","hidden"),jQuery("#shortcode-pre-"+a).show().attr("aria-hidden","false").css("visibility","visible")},350)}}]),ingotApp.controller("clickDelete",["$scope","$http","$stateParams","$state",function(a,b,c,d){var e=c.groupID;"undefined"==e?(swal({title:INGOT_TRANSLATION.fail,text:INGOT_TRANSLATION.sorry,type:"error",confirmButtonText:INGOT_TRANSLATION.close}),d.go("clickTests.list")):swal({title:INGOT_TRANSLATION.are_you_sure,text:INGOT_TRANSLATION.delete_confirm,type:"warning",showCancelButton:!0,confirmButtonText:INGOT_TRANSLATION["delete"],cancelButtonText:INGOT_TRANSLATION.cancel,closeOnConfirm:!1,closeOnCancel:!1},function(c){c?b({url:INGOT_ADMIN.api+"groups/"+e+"?_wpnonce="+INGOT_ADMIN.nonce,method:"DELETE",headers:{"X-WP-Nonce":INGOT_ADMIN.nonce}}).then(function(){swal(INGOT_TRANSLATION.deleted,"","success"),a.group={},d.go("clickTests.list")},function(a){var b=a.data,c=INGOT_TRANSLATION.sorry;_.isObject(b)&&"undefined"!=typeof b.message&&(c=b.message),d.go("clickTests.list"),swal({title:INGOT_TRANSLATION.fail,text:c,type:"error",confirmButtonText:INGOT_TRANSLATION.close})}):(swal(INGOT_TRANSLATION.canceled,"","success"),d.go("clickTests.list"))})}]),ingotApp.controller("clickGroup",["$scope","$http","$stateParams","$rootScope","$state","groupsFactory",function(a,b,c,d,e,f){var g=!1;if(a.group_step=1,a.new_group=!1,a.click_type_options=INGOT_ADMIN.click_type_options,a.destinations=INGOT_ADMIN.destinations,a.pages={},"clickTests.new"==e.current.name)g=!0,a.new_group=!0,a.group={type:"click",click_type_options:INGOT_ADMIN.click_type_options,variants:{},meta:{},name:""};else{a.group_step=3;var h=c.groupID;f.get({id:h},function(b){function c(a){for(var b={},c=0;c<a.length;++c)void 0!==a[c]&&(b[c]=a[c]);return b}"array"==typeof b.meta&&(b.meta=c(b.meta)),a.group=b,a.choose_group_type(a.group.sub_type)},function(a,b,c,d){swal({title:INGOT_TRANSLATION.fail,text:INGOT_TRANSLATION.sorry,type:"error",confirmButtonText:INGOT_TRANSLATION.close})})}a.buttonStyle=function(b,c){var d={};return"button_color"==c?(a.group.variants[b]&&a.group.variants[b].meta&&a.group.variants[b].meta.background_color&&(d["background-color"]=a.group.variants[b].meta.background_color),a.group.variants[b]&&a.group.variants[b].meta&&a.group.variants[b].meta.color&&(d.color=a.group.variants[b].meta.color),d):(d={},a.group.meta&&a.group.meta.background_color&&(d["background-color"]=a.group.meta.background_color),a.group.meta&&a.group.meta.color&&(d.color=a.group.meta.color),d)},a.removeTest=function(b){return delete a.group.variants[b],!1},a.submit=function(c){var d;d="clickTests.new"==e.current.name?INGOT_ADMIN.api+"groups/?context=admin":INGOT_ADMIN.api+"groups/"+h+"?context=admin",d+="&_wpnonce="+INGOT_ADMIN.nonce,b({method:"POST",headers:{"X-WP-Nonce":INGOT_ADMIN.nonce},url:d,data:a.group}).then(function(b){a.group=b.data,a.pages={},!0===g&&(g=!1,e.go("clickTests.edit",{groupID:a.group.ID})),swal({title:INGOT_TRANSLATION.group_saved,text:"",type:"success",confirmButtonText:INGOT_TRANSLATION.close})},function(a){var b=a.data,c=INGOT_TRANSLATION.sorry;_.isObject(b)&&"undefined"!=typeof b.message&&(c=b.message),swal({title:INGOT_TRANSLATION.fail,text:c,type:"error",confirmButtonText:INGOT_TRANSLATION.close})})},a.addNewTest=function(b){var c="ingot_"+Math.random().toString(36).substring(7);jQuery.isEmptyObject(a.group.variants)&&(a.group.variants={}),a.group.variants[c]={ID:c}},a.change_step=function(b){_.isUndefined(a.group.name)||_.isEmpty(a.group.name)?(swal({title:INGOT_TRANSLATION.group.must_name,text:"",type:"error",confirmButtonText:INGOT_TRANSLATION.close}),a.group_step=1):2!=b&&(_.isUndefined(a.group.sub_type)||_.isEmpty(a.group.sub_type))?(swal({title:INGOT_TRANSLATION.group.must_type,text:"",type:"error",confirmButtonText:INGOT_TRANSLATION.close}),a.group_step=2):a.group_step=b},a.choose_group_type=function(b){a.group.sub_type=b},a.has_type=function(){return a.group?"undefined"==a.group.sub_type||null==a.group.sub_type?!1:!0:void 0},a.is_page=function(){return"undefined"!=a.group.meta.destination&&"page"==a.group.meta.destination?!0:void 0},a.is_hook=function(){return"undefined"!=a.group.meta.destination&&"hook"==a.group.meta.destination?!0:void 0},a.destinationSelected=function(b){return"undefined"==a.group.meta.destination||"undefined"==b.value?!1:b.value==a.group.meta.destination?!0:void 0},a.destinationDescription=function(){if(!_.isUndefined(a.group.meta.destination)&&_.has(INGOT_ADMIN.destinations,a.group.meta.destination)){var b=INGOT_ADMIN.destinations[a.group.meta.destination],c=document.getElementById("destination-description");null!=c&&(c.innerHTML=b.description)}},a.$watch("group.meta.page",function(c,d){c!=d&&setTimeout(function(){b({url:INGOT_ADMIN.api+"settings/page-search?search="+c+"&_wpnonce="+INGOT_ADMIN.nonce+"&context=admin",method:"GET",headers:{"X-WP-Nonce":INGOT_ADMIN.nonce}}).then(function(b){a.pages=b.data})},500)}),a.showPageSearch=function(){return _.isEmpty(a.pages)}}]),ingotApp.controller("clickStats",["$scope","$rootScope","$http","$stateParams","$state","groupsFactory",function(a,b,c,d,e,f){var g=d.groupID;a.no_stats=INGOT_TRANSLATION.no_stats,a.group_id=g,"undefined"==g?(swal({title:INGOT_TRANSLATION.fail,text:INGOT_TRANSLATION.sorry,type:"error",confirmButtonText:INGOT_TRANSLATION.close}),e.go("clickTests.list")):c({url:INGOT_ADMIN.api+"groups/"+g+"/stats?_wpnonce="+INGOT_ADMIN.nonce+"&context=admin",method:"GET",headers:{"X-WP-Nonce":INGOT_ADMIN.nonce}}).then(function(b){var c=b.data;return a.stats_exist=!0,Object.keys(c.variants).length?(a.stats=c,a.chart_data={labels:[],datasets:[{label:[INGOT_TRANSLATION.stats.c_rate],fillColor:"rgba(220,220,220,0.5)",strokeColor:"rgba(220,220,220,0.8)",highlightFill:"rgba(220,220,220,0.75)",highlightStroke:"rgba(220,220,220,1)",data:[]}]},angular.forEach(a.stats.variants,function(b,c){var d;d=_.isUndefined(b.name)||_.isEmpty(b.name)||" "==b.name?INGOT_TRANSLATION.stats.variant+" "+c:b.name,a.chart_data.labels.push(d);var e=Math.round(100*b.conversion_rate);a.chart_data.datasets[0].data.push(e)}),a.stats.group.conversion_rate=Math.round(100*a.stats.group.conversion_rate),void a.setChart(100*a.stats.group.average_conversion_rate)):void(a.stats_exist=!1)}),Chart.types.Bar.extend({name:"BarOverlay",draw:function(a){Chart.types.Bar.prototype.draw.apply(this);for(var c=this.chart.ctx,d=(this.scale.calculateBarWidth(this.datasets.length),0);d<this.options.verticalOverlayAtBar.length;++d){var e=this.options.verticalOverlayAtBar[d],f=(this.scale.calculateBarX(this.datasets.length,0,e),this.scale.calculateY(e));this.scale.endPoint;c.beginPath(),c.lineWidth=2,c.strokeStyle="rgba(255, 0, 0, 1.0)",c.moveTo(100,f),c.lineTo(jQuery("#ingotChart").outerWidth(),f),c.stroke(),c.font="14px Arial",c.fillStyle="black",c.fillText(b.translate.stats.g_avg_c_rate+"("+Math.round(100*e)/100+"%)",jQuery("#ingotChart").outerWidth(),f-10)}c.closePath()}}),a.setChart=function(b){var c=document.getElementById("ingotChart").getContext("2d");setTimeout(function(){new Chart(c).BarOverlay(a.chart_data,{scaleLabel:"          <%=value%>%",responsive:!0,barValueSpacing:10,verticalOverlayAtBar:[b]})},100)}}]),ingotApp.controller("priceGroups",["$scope","$http","groupsFactory",function(a,b,c){var d=10;b({url:INGOT_ADMIN.api+"products/plugins?context=list&_wpnonce="+INGOT_ADMIN.nonce,method:"GET",headers:{"X-WP-Nonce":INGOT_ADMIN.nonce}}).then(function(b,c,d,e){a.plugins=response.data,a.possible=!1,angular.forEach(b,function(b,c){0==a.possible&&1==b.active&&(a.possible=!0)})},function(a){console.log(a)}),c.query({page:1,limit:d,context:"admin",type:"price"},function(b){if(a.total_pages=!1,a.groups=JSON.parse(b.data),b.headers["x-ingot-total"]){var c=parseInt(b.headers["x-ingot-total"]);total_pages=c/d,a.total_pages=new Array(Math.round(total_pages))}}),a.paginate=function(b,e){jQuery(".paginate a.active").length&&jQuery(".paginate a.active").toggleClass("active"),jQuery(e.currentTarget).toggleClass("active"),b+=1,c.query({page:b,limit:d,context:"admin"},function(b){b.data.indexOf("No matching groups found.")>=0||(a.groups=JSON.parse(b.data))})}}]),ingotApp.controller("priceGroup",["$scope","$http","$stateParams","$rootScope","$state","groupsFactory",function(a,b,c,d,e,f){var g=!1;if("priceTests.new"==e.current.name&&(g=!0),b({url:INGOT_ADMIN.api+"products/plugins?_wpnonce="+INGOT_ADMIN.nonce,method:"GET",headers:{"X-WP-Nonce":INGOT_ADMIN.nonce}}).then(function(b){a.plugins=b.data}),g)a.group={type:"price",price_type_options:INGOT_ADMIN.price_type_options};else{var h=c.groupID;f.get({id:h},function(b){"N"!=b[0]&&"o"!=b[1]&&(a.group=b,a.products())},function(a,b,c,d){console.log(a),swal({title:INGOT_TRANSLATION.fail,text:INGOT_TRANSLATION.sorry,type:"error",confirmButtonText:INGOT_TRANSLATION.close})})}a.getBasePrice=function(){var c=a.group.meta.product_ID;b({url:INGOT_ADMIN.api+"products/price/"+c+"?plugin="+a.group.sub_type+"&_wpnonce="+INGOT_ADMIN.nonce,method:"GET",headers:{"X-WP-Nonce":INGOT_ADMIN.nonce}}).then(function(b){a.basePrice=parseFloat(b.data.price)})},a.submit=function(){angular.forEach(a.group.variants,function(a,b){a["default"]=parseFloat(a["default"]/100)}),a.group.type="price",f.save(a.group,function(a){console.log(a),g&&(alert(a.ID),e.go("priceTests.edit",{groupID:a.ID})),swal({title:INGOT_TRANSLATION.group_saved,text:"",type:"success",confirmButtonText:INGOT_TRANSLATION.close})},function(a){console.log(a),swal({title:INGOT_TRANSLATION.fail,text:INGOT_TRANSLATION.sorry,type:"error",confirmButtonText:INGOT_TRANSLATION.close})})},a.addNewTest=function(b){var c="ingot_"+Math.random().toString(36).substring(7);a.group.variants||(a.group.variants=[]),a.group.variants.push({ID:c,"default":0,price:a.basePrice}),setTimeout(function(){jQuery(".slider-"+c).slider({value:0,min:-99,max:99,slide:function(b,d){var e=jQuery(b.target).data("index"),f=d.value;a.group.variants[e]["default"]=f,jQuery(".slider-"+c+"-val").html(f+"%"),0==parseFloat(f)?a.group.variants[e].price=a.basePrice:a.group.variants[e].price=a.basePrice*(f/100),a.group.variants[e].price.meta=f}}),a.$apply()},50)},a.products=function(){"string"!=typeof a.group.sub_type&&(a.products={}),b({url:INGOT_ADMIN.api+"products?plugin="+a.group.sub_type+"&_wpnonce="+INGOT_ADMIN.nonce,method:"GET",headers:{"X-WP-Nonce":INGOT_ADMIN.nonce}}).then(function(b,c,d,e){a.products=b.data})}}]),ingotApp.controller("support",["$scope","$http",function(a,b){}]),ingotApp.controller("welcome",["$scope","$http",function(a,b){a.welcome=INGOT_TRANSLATION.welcome;var c=INGOT_ADMIN.api+"settings?context=admin&_wpnonce="+INGOT_ADMIN.nonce;b({method:"GET",url:c,headers:{"X-WP-Nonce":INGOT_ADMIN.nonce}}).then(function(b,c,d,e){a.welcome.settings=b})}]),ingotApp.controller("settings",["$scope","$http",function(a,b){var c=INGOT_ADMIN.api+"settings?context=admin&_wpnonce="+INGOT_ADMIN.nonce;b({method:"GET",url:c,headers:{"X-WP-Nonce":INGOT_ADMIN.nonce}}).then(function(b){a.settings=b.data},function(a){INGOT_TRANSLATION.sorry;_.isObject(a)&&"undefined"!=typeof a.data.message&&swal({title:INGOT_TRANSLATION.fail,text:a.data.message,type:"error",confirmButtonText:INGOT_TRANSLATION.close})}),a.submit=function(){b({method:"POST",headers:{"X-WP-Nonce":INGOT_ADMIN.nonce},url:c,data:a.settings}).then(function(b){a.settings=b.data,swal({title:INGOT_TRANSLATION.settings_saved,text:"",type:"success",confirmButtonText:INGOT_TRANSLATION.close})},function(a){var b=a.data,c=INGOT_TRANSLATION.sorry;_.isObject(b)&&"undefined"!=typeof b.message&&(c=b.message),swal({title:INGOT_TRANSLATION.fail,text:c,type:"error",confirmButtonText:INGOT_TRANSLATION.close})})}}]),ingotApp.factory("groupsFactory",function(a){return a(INGOT_ADMIN.api+"groups/:id",{id:"@id",_wpnonce:INGOT_ADMIN.nonce,context:"admin"},{query:{transformResponse:function(a,b){var c={data:a,headers:b()};return c}},update:{method:"PUT",headers:{"X-WP-Nonce":INGOT_ADMIN.nonce}},post:{method:"POST",headers:{"X-WP-Nonce":INGOT_ADMIN.nonce}},save:{method:"POST",headers:{"X-WP-Nonce":INGOT_ADMIN.nonce}},"delete":{method:"DELETE",headers:{"X-WP-Nonce":INGOT_ADMIN.nonce}}})});